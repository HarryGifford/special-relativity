(self.webpackChunksr_frontend=self.webpackChunksr_frontend||[]).push([[35],{4035:(e,t,n)=>{"use strict";n.r(t);var a=n(7734);n(6790);const i=async e=>{const t=await fetch(e);if(!t.ok)throw new Error(t.statusText);return t.text()},r=()=>{sessionStorage.uiState=JSON.stringify(l)},o={cameraBeta:.95,useFixedVelocity:!1,useNoTimeDelay:!1,galilean:!1,simultaneityFrame:1,relativisticBeaming:!1,dopplerEffect:!1,timePulse:!1},s=()=>null!=sessionStorage.uiState?JSON.parse(sessionStorage.uiState):o;let l=s();const c=({el:e,id:t,options:n})=>{const a=n.map((({value:e})=>{const n=document.createElement("input");return n.name=t,n.type="radio",n.value=String(e),n})),i=e;for(let e=0;e<n.length;e++){const t=document.createElement("label");t.appendChild(a[e]),t.append(n[e].label),i.append(t)}return{buttons:a,onChange:e=>{a.forEach(((t,a)=>{n[a].value,t.onclick=t=>{const i=t.target;if(null==i||!(i instanceof HTMLInputElement))return;const r=n[a].value;e(r)}}))},setValue:e=>{for(let t=0;t<n.length;t++){const{value:i}=n[t];a[t].checked=i===e}},setDisabled:e=>{for(let t=0;t<n.length;t++)a[t].disabled=e}}},d=()=>sessionStorage.relativityScene||"SubdividedCube.gltf",p=e=>{l=s();const t=(()=>{const e=document.createElement("input");return e.type="number",e.min="0",e.max="1",e.step="0.005",e.inputMode="decimal",e.value=l.cameraBeta?.toString(),e.title="Camera speed as a fraction of the speed of light.",e})();t.addEventListener("change",(e=>{const t=e.target;if(null==t||!(t instanceof HTMLInputElement))return;const n=parseFloat(t.value);Number.isNaN(n)||(l.cameraBeta=n,r())}));const n=(()=>{const e=document.createElement("input");return e.type="checkbox",e.checked=l.useFixedVelocity,e})();n.addEventListener("change",(e=>{const t=e.target;if(null==t||!(t instanceof HTMLInputElement))return;const n=t.checked;l.useFixedVelocity=n,r()}));const a=(()=>{const e=document.createElement("input");return e.type="checkbox",e.checked=l.galilean,e})();a.addEventListener("change",(e=>{const t=e.target;null!=t&&t instanceof HTMLInputElement&&(l.galilean=!!t.checked,r())}));const i=(()=>{const e=document.createElement("input");return e.type="checkbox",e.checked=l.relativisticBeaming,e})();i.addEventListener("change",(e=>{const t=e.target;null!=t&&t instanceof HTMLInputElement&&(l.relativisticBeaming=!!t.checked,r())}));const o=(()=>{const e=document.createElement("input");return e.type="checkbox",e.checked=l.dopplerEffect,e})();o.addEventListener("change",(e=>{const t=e.target;null!=t&&t instanceof HTMLInputElement&&(l.dopplerEffect=!!t.checked,r())}));const p=(()=>{const e=document.createElement("input");return e.type="checkbox",e.checked=l.timePulse,e})();p.addEventListener("change",(e=>{const t=e.target;null!=t&&t instanceof HTMLInputElement&&(l.timePulse=!!t.checked,r())}));const u=document.createElement("label");u.appendChild(t),u.append("Max camera speed (fraction of c)");const m=document.createElement("label");m.appendChild(n),m.append("Assume fixed camera speed");const h=document.createElement("label");h.appendChild(a),h.append("Use Galilean relativity");const g=document.createElement("label");g.appendChild(i),g.append("Relativistic beaming");const f=document.createElement("label");f.appendChild(o),f.append("Doppler effect");const y=document.createElement("label");y.appendChild(p),y.append("Show synchronization");const b=(()=>{const e=document.createElement("div"),t=document.createElement("label"),n=(()=>{const e=document.createElement("input");return e.type="checkbox",e.checked=l.useNoTimeDelay,e})();t.appendChild(n),t.append("Assume no light travel time in frame:"),n.addEventListener("change",(e=>{const t=e.target;if(null==t||!(t instanceof HTMLInputElement))return;const n=!!t.checked;l.useNoTimeDelay=n,r(),o(!n)})),e.appendChild(t);const{onChange:a,setValue:i,setDisabled:o}=c({el:e,id:"simultaneity-frame",options:[{label:"Camera",value:1},{label:"World",value:0}]});return i(l.simultaneityFrame),o(!l.useNoTimeDelay),a((e=>{l.simultaneityFrame=e,r()})),e})(),v=(()=>{const e=document.createElement("div"),t=document.createElement("label");t.append("Scene:"),e.appendChild(t);const{onChange:n,setValue:a}=c({el:e,id:"scene-picker",options:[{label:"Dice",value:"SubdividedCube.gltf"},{label:"Sponza",value:"https://specialrelativitymeshes.z5.web.core.windows.net/Sponza/sponza.gltf"}]});return a(d()),n((e=>{sessionStorage.relativityScene=e,window.location.reload()})),e})(),E=document.createElement("details");E.className="main-ui";const x=document.createElement("summary");x.innerText="Help / Settings",E.appendChild(x);const S=document.createElement("div");S.innerText="Use WASD and mouse to move or touch on smartphone.",E.appendChild(S),E.appendChild(u),E.appendChild(g),E.appendChild(f),E.appendChild(b),E.appendChild(y),E.appendChild(h),E.appendChild(m),E.appendChild(v),e.appendChild(E)};class u extends a.xcu{constructor(e,t,n){super(e,t,n),this.velocity=a.Pa4.Zero(),this.properVelocity=a.Pa4.Zero(),this.properAcceleration=a.Pa4.Zero(),this.dt=0,this.onAfterCheckInputsObservable.add(((e,t)=>{let n=this.dt;this.properAcceleration.copyFrom(this.cameraDirection);const a=this.dragCoefficient??0,i=this.properVelocity.normalizeToNew().scale(a*this.speed*this.inertia*Math.sqrt(this.properVelocity.length()));this.properAcceleration.subtractInPlace(i),this.properVelocity.addInPlace(this.properAcceleration.scale(n));let r=this.properVelocity.lengthSquared();null!=this.maxProperSpeed2&&r>this.maxProperSpeed2&&(this.properVelocity.normalize().scaleInPlace(Math.sqrt(this.maxProperSpeed2)),r=this.maxProperSpeed2);const o=1/Math.sqrt(1+r);this.properVelocity.scaleToRef(o,this.velocity),this.position.addInPlace(this.velocity.scale(n))}))}setMaxSpeed(e){if(null==e)return this.maxProperSpeed2=void 0,void(this.dragCoefficient=0);this.speed=e;const t=e*e,n=t<1?1/(1-t):1e4;this.maxProperSpeed2=n*t,this.dragCoefficient=1/Math.pow(this.maxProperSpeed2,1/4)}_computeLocalCameraSpeed(){return this.speed}_checkInputs(){var e=this.getEngine();this.dt=Math.sqrt(e.getDeltaTime()/(100*e.getFps())),this.dt>.1&&(this.dt=.1),this.cameraDirection.setAll(0),this.cameraRotation.scaleInPlace(Math.exp(-this.dt)*this.inertia),super._checkInputs()}_updatePosition(){}}const m=()=>(new Date).getTime(),h=m(),g=(e,t)=>{null!=t.int&&Object.entries(t.int).forEach((([t,n])=>{e.setInt(t,n)})),null!=t.vec3&&Object.entries(t.vec3).forEach((([t,n])=>{e.setVector3(t,n)})),null!=t.float&&Object.entries(t.float).forEach((([t,n])=>{e.setFloat(t,n)}))};(async({el:e,sceneFilename:t})=>{p(e);const n=(e=>{const t=document.createElement("canvas");return t.style.position="absolute",t.width=e.clientWidth,t.height=e.clientHeight,t.style.position="fixed",t.tabIndex=0,window.addEventListener("resize",(n=>{t.width=e.clientWidth,t.height=e.clientHeight})),e.appendChild(t),t})(e),r=(e=>{const t=document.createElement("div");return t.classList.add("speed-indicator"),e.appendChild(t),t})(e),[o,l]=await Promise.all([i("main.vert"),i("main.frag")]),c=new a.D4V(n,!0);a.Qmf.ShadersStore.customVertexShader=o,a.Qmf.ShadersStore.customFragmentShader=l;const d=await a.n0n.LoadAsync(t),f=d.getNodeByID("Camera"),y=f?.position||new a.Pa4(0,.33,-9),b=f?.rotationQuaternion,v=((e,t,n)=>{const a=new u("camera1",t,n);return(e=>{e.keysDownward.push(81),e.keysDown.push(83),e.keysUpward.push(69),e.keysUp.push(87),e.keysLeft.push(65),e.keysRight.push(68),e.gamepadAngularSensibility=100,(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPhone/i))&&e.inputs.addVirtualJoystick(),e.speed=1,e.inertia=.9,e.minZ=.1,e.maxZ=1e4,e.fov=.9})(a),a})(0,y,d);null!=b?(v.rotationQuaternion=b,v.update()):v.setTarget(a.Pa4.Zero()),v.attachControl(!0);const E=new a.xEZ("./lambda_rgb_map.png",d,!1,void 0,a.xEZ.BILINEAR_SAMPLINGMODE);d.skipFrustumClipping=!0;const x=d.meshes.filter((e=>!(e instanceof a.SPe)&&null!=e.material)).map((e=>{const t=e.material;if(null==t)throw new Error("Material should not be null");const n=t.albedoTexture,i=t.bumpTexture,r=new a.jyz("shader"+e.name,d,{vertexSource:o,fragmentSource:l},{attributes:["position","normal","tangent","uv"],uniforms:["world","finalWorld","view","projection","velocity","simultaneityFrame","useGalilean","useNoTimeDelay","dopplerEffect","relativisticBeaming","time","timePulse"],samplers:["albedoSampler","bumpSampler","rgbMapSampler"],defines:null!=i?["#define TANGENT"]:[]});return r.setTexture("rgbMapSampler",E),null!=n&&r.setTexture("albedoSampler",n),null!=i&&r.setTexture("bumpSampler",i),e.material=r,r})),{skyboxMaterial:S}=await(async e=>{const t=a.VO7.CreateBox("skybox",{size:1e3,sideOrientation:a.Kj0.BACKSIDE}),[n,r]=await Promise.all([i("skybox.vert"),i("main.frag")]),o=new a.jyz("skybox",e,{vertexSource:n,fragmentSource:r},{attributes:["position","normal","uv"],uniforms:["view","projection","velocity","simultaneityFrame","useGalilean","useNoTimeDelay","dopplerEffect","relativisticBeaming"],samplers:["skyboxSampler","rgbMapSampler"],defines:["#define SKYBOX"]});t.infiniteDistance=!0,t.material=o;const s=new a.BtG("skybox/skybox",e,["_px.png","_py.png","_pz.png","_nx.png","_ny.png","_nz.png"]);return s.coordinatesMode=a.xEZ.SKYBOX_MODE,o.setTexture("skyboxSampler",s),{skybox:t,skyboxMaterial:o,cubeTexture:s}})(d);S.setTexture("rgbMapSampler",E),c.runRenderLoop((function(){const{cameraBeta:e}=s();v.setMaxSpeed(e);const t=(e=>{const{cameraBeta:t,galilean:n,simultaneityFrame:i,useFixedVelocity:r,useNoTimeDelay:o,relativisticBeaming:l,dopplerEffect:c,timePulse:d}=s();return{vec3:{velocity:null==e.velocity||r?e.getDirection(a.Pa4.Forward()).scale(t):e.velocity},float:{time:(m()-h)/1e3},int:{useNoTimeDelay:o?1:0,simultaneityFrame:i,useGalilean:n?1:0,relativisticBeaming:l?1:0,dopplerEffect:c?1:0,timePulse:d?1:0}}})(v);g(S,t),x.forEach((e=>{g(e,t)}));const n=t.vec3.velocity.length(),i=1/Math.sqrt(1-n*n);r.innerHTML=[`Speed: ${n.toFixed(3)}c`,`Gamma: ${i.toFixed(3)}`].join("<br/>"),d.render()})),window.addEventListener("resize",(function(){c.resize()})),n.focus()})({el:document.body,sceneFilename:d()}).catch(console.error)}}]);
//# sourceMappingURL=35.bootstrap.js.map