(self.webpackChunksr_frontend=self.webpackChunksr_frontend||[]).push([[35],{4035:(e,t,a)=>{"use strict";a.r(t);var n=a(7734);a(6790);const i=async e=>{const t=await fetch(e);if(!t.ok)throw new Error(t.statusText);return t.text()},r=()=>{sessionStorage.uiState=JSON.stringify(o)},l={cameraBeta:.95,useFixedVelocity:!1,useNoTimeDelay:!1,galilean:!1,simultaneityFrame:1,relativisticBeaming:!1,dopplerEffect:!1,timePulse:!1},s=()=>null!=sessionStorage.uiState?JSON.parse(sessionStorage.uiState):l;let o=s();const c=({attributeName:e,label:t})=>{const a=document.createElement("input");a.type="checkbox",a.checked=o[e],a.addEventListener("change",(t=>{const a=t.target;null!=a&&a instanceof HTMLInputElement&&(o[e]=!!a.checked,r())}));const n=document.createElement("label");return n.appendChild(a),n.append(t),{toggleLabel:n,toggle:a}},p=({el:e,id:t,options:a,onChange:n})=>{const i=a.map((({value:e})=>{const a=document.createElement("input");return a.name=t,a.type="radio",a.value=String(e),a})),r=e;for(let e=0;e<a.length;e++){const t=document.createElement("label");t.appendChild(i[e]),t.append(a[e].label),r.append(t)}return null!=n&&i.forEach(((e,t)=>{const i=a[t].value;e.onclick=()=>{n(i)}})),{buttons:i,setValue:e=>{for(let t=0;t<a.length;t++){const{value:n}=a[t];i[t].checked=n===e}},setDisabled:e=>{for(let t=0;t<a.length;t++)i[t].disabled=e}}},d=()=>sessionStorage.relativityScene||"SubdividedCube.gltf";class u extends n.xcu{constructor(e,t,a){super(e,t,a),this.velocity=n.Pa4.Zero(),this.properVelocity=n.Pa4.Zero(),this.properAcceleration=n.Pa4.Zero(),this.dt=0,this.onAfterCheckInputsObservable.add(((e,t)=>{let a=this.dt;this.properAcceleration.copyFrom(this.cameraDirection);const n=this.dragCoefficient??0,i=this.properVelocity.normalizeToNew().scale(n*this.speed*this.inertia*Math.sqrt(this.properVelocity.length()));this.properAcceleration.subtractInPlace(i),this.properVelocity.addInPlace(this.properAcceleration.scale(a));let r=this.properVelocity.lengthSquared();null!=this.maxProperSpeed2&&r>this.maxProperSpeed2&&(this.properVelocity.normalize().scaleInPlace(Math.sqrt(this.maxProperSpeed2)),r=this.maxProperSpeed2);const l=1/Math.sqrt(1+r);this.properVelocity.scaleToRef(l,this.velocity),this.position.addInPlace(this.velocity.scale(a))}))}setMaxSpeed(e){if(null==e)return this.maxProperSpeed2=void 0,void(this.dragCoefficient=0);this.speed=e;const t=e*e,a=t<1?1/(1-t):1e4;this.maxProperSpeed2=a*t,this.dragCoefficient=1/Math.pow(this.maxProperSpeed2,1/4)}_computeLocalCameraSpeed(){return this.speed}_checkInputs(){var e=this.getEngine();this.dt=Math.sqrt(e.getDeltaTime()/(100*e.getFps())),this.dt>.1&&(this.dt=.1),this.cameraDirection.setAll(0),this.cameraRotation.scaleInPlace(Math.exp(-this.dt)*this.inertia),super._checkInputs()}_updatePosition(){}}const m=()=>(new Date).getTime(),h=m(),g=(e,t)=>{null!=t.int&&Object.entries(t.int).forEach((([t,a])=>{e.setInt(t,a)})),null!=t.vec3&&Object.entries(t.vec3).forEach((([t,a])=>{e.setVector3(t,a)})),null!=t.float&&Object.entries(t.float).forEach((([t,a])=>{e.setFloat(t,a)}))};(async({el:e,sceneFilename:t})=>{(e=>{o=s();const t=(()=>{const e=document.createElement("input");return e.type="number",e.min="0",e.max="1",e.step="0.005",e.inputMode="decimal",e.value=o.cameraBeta?.toString(),e.title="Camera speed as a fraction of the speed of light.",e})();t.addEventListener("change",(e=>{const t=e.target;if(null==t||!(t instanceof HTMLInputElement))return;const a=parseFloat(t.value);Number.isNaN(a)||(o.cameraBeta=a,r())}));const{toggleLabel:a}=c({attributeName:"useFixedVelocity",label:"Assume fixed camera speed"}),{toggleLabel:n}=c({attributeName:"galilean",label:"Use Galilean relativity"}),{toggleLabel:i}=c({attributeName:"relativisticBeaming",label:"Relativistic beaming"}),{toggleLabel:l}=c({attributeName:"dopplerEffect",label:"Doppler effect"}),{toggleLabel:u}=c({attributeName:"timePulse",label:"Show synchronization"}),m=document.createElement("label");m.appendChild(t),m.append("Max camera speed (fraction of c)");const h=(()=>{const e=document.createElement("div"),{toggle:t,toggleLabel:a}=c({attributeName:"useNoTimeDelay",label:"Assume no light travel time in frame:"});t.addEventListener("change",(e=>{const t=e.target;if(null==t||!(t instanceof HTMLInputElement))return;const a=!!t.checked;i(!a)})),e.appendChild(a);const{setValue:n,setDisabled:i}=p({el:e,id:"simultaneity-frame",options:[{label:"Camera",value:1},{label:"World",value:0}],onChange:e=>{o.simultaneityFrame=e,r()}});return n(o.simultaneityFrame),i(!o.useNoTimeDelay),e})(),g=(()=>{const e=document.createElement("div"),t=document.createElement("label");t.append("Scene:"),e.appendChild(t);const{setValue:a}=p({el:e,id:"scene-picker",options:[{label:"Dice",value:"SubdividedCube.gltf"},{label:"Sponza",value:"https://specialrelativitymeshes.z5.web.core.windows.net/Sponza/sponza.gltf"}],onChange:e=>{sessionStorage.relativityScene=e,window.location.reload()}});return a(d()),e})(),b=document.createElement("details");b.className="main-ui";const f=document.createElement("summary");f.innerText="Help / Settings",b.appendChild(f);const y=document.createElement("div");y.innerText="Use WASD and mouse to move or touch on smartphone.",b.appendChild(y),b.appendChild(m),b.appendChild(i),b.appendChild(l),b.appendChild(h),b.appendChild(u),b.appendChild(n),b.appendChild(a),b.appendChild(g),e.appendChild(b)})(e);const a=(e=>{const t=document.createElement("canvas");return t.style.position="absolute",t.width=e.clientWidth,t.height=e.clientHeight,t.style.position="fixed",t.tabIndex=0,window.addEventListener("resize",(a=>{t.width=e.clientWidth,t.height=e.clientHeight})),e.appendChild(t),t})(e),l=(e=>{const t=document.createElement("div");return t.classList.add("speed-indicator"),e.appendChild(t),t})(e),[b,f]=await Promise.all([i("main.vert"),i("main.frag")]),y=new n.D4V(a,!0);n.Qmf.ShadersStore.customVertexShader=b,n.Qmf.ShadersStore.customFragmentShader=f;const v=await n.n0n.LoadAsync(t),S=v.getNodeByID("Camera"),x=S?.position||new n.Pa4(0,.33,-9),E=S?.rotationQuaternion,w=((e,t,a)=>{const n=new u("camera1",t,a);return(e=>{e.keysDownward.push(81),e.keysDown.push(83),e.keysUpward.push(69),e.keysUp.push(87),e.keysLeft.push(65),e.keysRight.push(68),e.gamepadAngularSensibility=100,(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPhone/i))&&e.inputs.addVirtualJoystick(),e.speed=1,e.inertia=.9,e.minZ=.1,e.maxZ=1e4,e.fov=.9})(n),n})(0,x,v);null!=E?(w.rotationQuaternion=E,w.update()):w.setTarget(n.Pa4.Zero()),w.attachControl(!0);const C=new n.xEZ("./lambda_rgb_map.png",v,!1,void 0,n.xEZ.BILINEAR_SAMPLINGMODE);v.skipFrustumClipping=!0;const k=v.meshes.filter((e=>!(e instanceof n.SPe)&&null!=e.material)).map((e=>{const t=e.material;if(null==t)throw new Error("Material should not be null");const a=t.albedoTexture,i=t.bumpTexture,r=new n.jyz("shader"+e.name,v,{vertexSource:b,fragmentSource:f},{attributes:["position","normal","tangent","uv"],uniforms:["world","finalWorld","view","projection","velocity","simultaneityFrame","useGalilean","useNoTimeDelay","dopplerEffect","relativisticBeaming","time","timePulse"],samplers:["albedoSampler","bumpSampler","rgbMapSampler"],defines:null!=i?["#define TANGENT"]:[]});return r.setTexture("rgbMapSampler",C),null!=a&&r.setTexture("albedoSampler",a),null!=i&&r.setTexture("bumpSampler",i),e.material=r,r})),{skyboxMaterial:P}=await(async e=>{const t=n.VO7.CreateBox("skybox",{size:1e3,sideOrientation:n.Kj0.BACKSIDE}),[a,r]=await Promise.all([i("skybox.vert"),i("main.frag")]),l=new n.jyz("skybox",e,{vertexSource:a,fragmentSource:r},{attributes:["position","normal","uv"],uniforms:["view","projection","velocity","simultaneityFrame","useGalilean","useNoTimeDelay","dopplerEffect","relativisticBeaming"],samplers:["skyboxSampler","rgbMapSampler"],defines:["#define SKYBOX"]});t.infiniteDistance=!0,t.material=l;const s=new n.BtG("skybox/skybox",e,["_px.png","_py.png","_pz.png","_nx.png","_ny.png","_nz.png"]);return s.coordinatesMode=n.xEZ.SKYBOX_MODE,l.setTexture("skyboxSampler",s),{skybox:t,skyboxMaterial:l,cubeTexture:s}})(v);P.setTexture("rgbMapSampler",C),y.runRenderLoop((function(){const{cameraBeta:e}=s();w.setMaxSpeed(e);const t=(e=>{const{cameraBeta:t,galilean:a,simultaneityFrame:i,useFixedVelocity:r,useNoTimeDelay:l,relativisticBeaming:o,dopplerEffect:c,timePulse:p}=s();return{vec3:{velocity:null==e.velocity||r?e.getDirection(n.Pa4.Forward()).scale(t):e.velocity},float:{time:(m()-h)/1e3},int:{useNoTimeDelay:l?1:0,simultaneityFrame:i,useGalilean:a?1:0,relativisticBeaming:o?1:0,dopplerEffect:c?1:0,timePulse:p?1:0}}})(w);g(P,t),k.forEach((e=>{g(e,t)}));const a=t.vec3.velocity.length(),i=1/Math.sqrt(1-a*a);l.innerHTML=[`Speed: ${a.toFixed(3)}c`,`Gamma: ${i.toFixed(3)}`].join("<br/>"),v.render()})),window.addEventListener("resize",(function(){y.resize()})),a.focus()})({el:document.body,sceneFilename:d()}).catch(console.error)}}]);
//# sourceMappingURL=35.bootstrap.js.map