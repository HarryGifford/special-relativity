(self.webpackChunksr_frontend=self.webpackChunksr_frontend||[]).push([[750],{3750:(e,t,n)=>{"use strict";n.r(t);var a=n(7734);n(6790);const i=async e=>{const t=await fetch(e);if(!t.ok)throw new Error(t.statusText);return t.text()},r=()=>{sessionStorage.uiState=JSON.stringify(s)},o={cameraBeta:.95,useFixedVelocity:!1,useNoTimeDelay:!1,galilean:!1,simultaneityFrame:1,relativisticBeaming:!1,dopplerEffect:!1},c=()=>null!=sessionStorage.uiState?JSON.parse(sessionStorage.uiState):o;let s=c();const l=e=>{s=c();const t=(()=>{const e=document.createElement("input");return e.type="number",e.min="0",e.max="1",e.step="0.005",e.inputMode="decimal",e.value=s.cameraBeta?.toString(),e.title="Camera speed as a fraction of the speed of light.",e})();t.addEventListener("change",(e=>{const t=e.target;if(null==t||!(t instanceof HTMLInputElement))return;const n=parseFloat(t.value);Number.isNaN(n)||(s.cameraBeta=n,r())}));const n=(()=>{const e=document.createElement("input");return e.type="checkbox",e.checked=s.useFixedVelocity,e})();n.addEventListener("change",(e=>{const t=e.target;if(null==t||!(t instanceof HTMLInputElement))return;const n=t.checked;s.useFixedVelocity=n,r()}));const a=(()=>{const e=document.createElement("input");return e.type="checkbox",e.checked=s.galilean,e})();a.addEventListener("change",(e=>{const t=e.target;null!=t&&t instanceof HTMLInputElement&&(s.galilean=!!t.checked,r())}));const i=(()=>{const e=document.createElement("input");return e.type="checkbox",e.checked=s.relativisticBeaming,e})();i.addEventListener("change",(e=>{const t=e.target;null!=t&&t instanceof HTMLInputElement&&(s.relativisticBeaming=!!t.checked,r())}));const o=(()=>{const e=document.createElement("input");return e.type="checkbox",e.checked=s.dopplerEffect,e})();o.addEventListener("change",(e=>{const t=e.target;null!=t&&t instanceof HTMLInputElement&&(s.dopplerEffect=!!t.checked,r())}));const l=document.createElement("label");l.appendChild(t),l.append("Max camera speed (fraction of c)");const d=document.createElement("label");d.appendChild(n),d.append("Assume fixed camera speed");const p=document.createElement("label");p.appendChild(a),p.append("Use Galilean relativity");const u=document.createElement("label");u.appendChild(i),u.append("Relativistic beaming");const m=document.createElement("label");m.appendChild(o),m.append("Doppler effect");const h=(()=>{const e=document.createElement("div"),t=document.createElement("label"),n=(()=>{const e=document.createElement("input");return e.type="checkbox",e.checked=s.useNoTimeDelay,e})();t.appendChild(n),t.append("Assume no light travel time in frame:"),e.appendChild(t);const a=document.createElement("input");a.name="simultaneity-frame",a.type="radio",a.disabled=!s.useNoTimeDelay,a.checked=1===s.simultaneityFrame,a.value="1";const i=document.createElement("label");i.appendChild(a),i.append("Camera");const o=document.createElement("input");o.name="simultaneity-frame",o.type="radio",o.disabled=!s.useNoTimeDelay,o.checked=0===s.simultaneityFrame,o.value="0";const c=document.createElement("label");c.appendChild(o),c.append("World"),n.addEventListener("change",(e=>{const t=e.target;if(null==t||!(t instanceof HTMLInputElement))return;const n=!!t.checked;s.useNoTimeDelay=n,r(),o.disabled=!n,a.disabled=!n}));const l=e=>{const t=e.target;if(null==t||!(t instanceof HTMLInputElement))return;const n=parseInt(t.value,10);s.simultaneityFrame=n,r()};return o.onclick=l,a.onclick=l,e.appendChild(c),e.appendChild(i),e})(),y=document.createElement("details");y.className="main-ui";const g=document.createElement("summary");g.innerText="Help / Settings",y.appendChild(g);const f=document.createElement("div");f.innerText="Use WASD and mouse to move or touch on smartphone.",y.appendChild(f),y.appendChild(l),y.appendChild(u),y.appendChild(m),y.appendChild(h),y.appendChild(d),y.appendChild(p),e.appendChild(y)};class d extends a.xcu{constructor(e,t,n){super(e,t,n),this.velocity=a.Pa4.Zero(),this.properVelocity=a.Pa4.Zero(),this.properAcceleration=a.Pa4.Zero(),this.dt=0,this.onAfterCheckInputsObservable.add(((e,t)=>{let n=this.dt;if(this.cameraDirection.length()<=a.kn4)this.properVelocity.scaleInPlace(Math.exp(-n)*this.inertia);else{this.properAcceleration.copyFrom(this.cameraDirection);const e=this.properVelocity.add(this.properAcceleration.scale(n));(null==this.maxProperSpeed2||e.lengthSquared()<this.maxProperSpeed2)&&this.properVelocity.copyFrom(e)}const i=this.properVelocity.lengthSquared(),r=1/Math.sqrt(1+i);this.properVelocity.scaleToRef(r,this.velocity),this.position.addInPlace(this.velocity.scale(n))}))}setMaxSpeed(e){if(null==e)return void(this.maxProperSpeed2=void 0);const t=e*e,n=1/(1-t);this.maxProperSpeed2=n*t}_computeLocalCameraSpeed(){return this.speed}_checkInputs(){var e=this.getEngine();this.dt=Math.sqrt(e.getDeltaTime()/(100*e.getFps())),this.cameraDirection.setAll(0),this.cameraRotation.scaleInPlace(Math.exp(-this.dt)*this.inertia),super._checkInputs()}_updatePosition(){}}const p=(e,t)=>{null!=t.int&&Object.entries(t.int).forEach((([t,n])=>{e.setInt(t,n)})),null!=t.vec3&&Object.entries(t.vec3).forEach((([t,n])=>{e.setVector3(t,n)}))};(async()=>{const e=document.body;l(e);const t=document.createElement("div");t.style.flex="1 1 auto",document.body.appendChild(t);const n=(e=>{const t=document.createElement("canvas");return t.style.position="absolute",t.width=e.clientWidth,t.height=e.clientHeight,t.style.position="fixed",t.tabIndex=0,window.addEventListener("resize",(n=>{t.width=e.clientWidth,t.height=e.clientHeight})),e.appendChild(t),t})(t),r=(e=>{const t=document.createElement("div");return t.classList.add("speed-indicator"),e.appendChild(t),t})(e),[o,s]=await Promise.all([i("main.vert"),i("main.frag")]),u=new a.D4V(n,!0,{deterministicLockstep:!0,lockstepMaxSteps:4});a.Qmf.ShadersStore.customVertexShader=o,a.Qmf.ShadersStore.customFragmentShader=s;const m=await a.n0n.LoadAsync(window.location.href,"SubdividedCube.gltf",u),h=m.getNodeByID("Camera"),y=h?.position||new a.Pa4(0,0,-1),g=h?.rotationQuaternion,f=((e,t,n)=>{const a=new d("camera1",t,n);return(e=>{e.keysDownward.push(81),e.keysDown.push(83),e.keysUpward.push(69),e.keysUp.push(87),e.keysLeft.push(65),e.keysRight.push(68),e.gamepadAngularSensibility=100,(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPhone/i))&&e.inputs.addVirtualJoystick(),e.speed=.5,e.inertia=.9,e.minZ=.1,e.maxZ=1e4,e.fov=.9})(a),a})(0,y,m);null!=g?(f.rotationQuaternion=g,f.update()):f.setTarget(a.Pa4.Zero()),f.attachControl(!0);const x=new a.xEZ("./lambda_rgb_map.png",m,!1,void 0,a.xEZ.BILINEAR_SAMPLINGMODE);m.skipFrustumClipping=!0;const v=m.meshes.filter((e=>!(e instanceof a.SPe))).map((e=>{const t=e.material?.albedoTexture,n=new a.jyz("shader"+e.name,m,{vertexSource:o,fragmentSource:s},{attributes:["position","normal","uv"],uniforms:["world","finalWorld","worldView","worldViewProjection","view","projection","viewProjection","velocity","textureSampler","simultaneityFrame","useGalilean","useNoTimeDelay","rgbMapSampler","dopplerEffect","relativisticBeaming"],defines:null!=t?["#define HAS_TEXTURE"]:[]});return n.setTexture("rgbMapSampler",x),null!=t&&n.setTexture("textureSampler",t),e.material=n,n})),{skyboxMaterial:E}=await(async e=>{const t=a.VO7.CreateBox("skybox",{size:1e3,sideOrientation:a.Kj0.BACKSIDE}),[n,r]=await Promise.all([i("skybox.vert"),i("skybox.frag")]),o=new a.jyz("skybox",e,{vertexSource:n,fragmentSource:r},{attributes:["position","normal","uv"],uniforms:["view","projection","velocity","textureSampler","simultaneityFrame","useGalilean","useNoTimeDelay","rgbMapSampler","dopplerEffect","relativisticBeaming","skyboxSampler","rgbMapSampler"]});t.infiniteDistance=!0,t.material=o;const c=new a.BtG("skybox/skybox",e,["_px.png","_py.png","_pz.png","_nx.png","_ny.png","_nz.png"]);return c.coordinatesMode=a.xEZ.SKYBOX_MODE,o.setTexture("skyboxSampler",c),{skybox:t,skyboxMaterial:o,cubeTexture:c}})(m);E.setTexture("rgbMapSampler",x),u.runRenderLoop((function(){const{cameraBeta:e}=c();f.setMaxSpeed(e);const t=(e=>{const{cameraBeta:t,galilean:n,simultaneityFrame:i,useFixedVelocity:r,useNoTimeDelay:o,relativisticBeaming:s,dopplerEffect:l}=c();return{vec3:{velocity:null==e.velocity||r?e.getDirection(a.Pa4.Forward()).scale(t):e.velocity},int:{useNoTimeDelay:o?1:0,simultaneityFrame:i,useGalilean:n?1:0,relativisticBeaming:s?1:0,dopplerEffect:l?1:0}}})(f);p(E,t),v.forEach((e=>{p(e,t)}));const n=t.vec3.velocity.length();r.innerText=`Speed: ${n.toFixed(3)}c`,m.render()})),window.addEventListener("resize",(function(){u.resize()})),n.focus()})().catch(console.error)}}]);
//# sourceMappingURL=750.bootstrap.js.map